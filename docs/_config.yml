# _config.yml â€” Jekyll site settings
# For technical reasons, this file is NOT reloaded automatically when using
# 'bundle exec jekyll serve'. Restart the server after changes.

title: Toronto Mega Empires
email: info@torontomegaempires.com

copyright: "Copyright (c) {currentYear} Rob McArthur"

description: >- # this means to ignore newlines until "baseurl:"
  Toronto Mega Empires is a Toronto group dedicated to promoting
  and playing Mega Empires.
baseurl: "" # the subpath of your site, e.g. /blog
url: "https://www.torontomegaempires.com" # the base hostname & protocol for your site, e.g. http://example.com

# Social links
social_links:
  discord: "https://discord.torontomegaempires.com"
  email: "mailto:info@torontomegaempires.com"

# Custom collections for different content types
collections:
  game_reports:
    output: true
    permalink: /:collection/:name/

# Better defaults
defaults:
  - scope:
      path: ""
      type: "posts"
    values:
      layout: "post"
      author: "Rob of the North"
  - scope:
      path: ""
      type: "game_reports"
    values:
      layout: "game_report"
      
# Build settings
# highlighter: none
markdown: kramdown
kramdown:
  input: GFM
  parse_block_html: true
  parse_span_html: true
  html_to_native: true
  
# Build settings
theme: minima

plugins:
  - jekyll-feed
  - jekyll-seo-tag
  - jekyll-sitemap
  - jekyll-paginate
  - jekyll-spaceship
  - jekyll_sqlite # see https://github.com/captn3m0/jekyll-sqlite
  - jekyll-datapage-generator

author: Rob of the North

# Control which pages appear in the site header nav
header_pages:
  - about.markdown
  - games.md

sqlite:
  - data: recent_results
    file: &db "_db/megaempires.db"
    query: "SELECT 
    game.*, 
    player.display as winner
  FROM game 
  LEFT JOIN game_player_nation ON game.id = game_player_nation.game_id 
  LEFT JOIN player ON player.id = game_player_nation.player_id
  WHERE game_player_nation.ast_pos = 1
  ORDER BY date(game.date) DESC 
  LIMIT 5"
  - data: players
    file: &db "_db/megaempires.db"
    query: SELECT * from player
  - data: games
    file: *db
    query: "select * from game order by date(date) desc"
  - data: game_players
    file: *db
    query: "select 
	game_player_nation.game_id,
	player.display as player, 
	nation.name as nation,
	game_player_nation.cities,
	game_player_nation.ast_pos,
	game_player_nation.score
from player
  join game_player_nation on 
	player.id=game_player_nation.player_id
  join nation on
    nation.id=game_player_nation.nation_id
order by game_player_nation.game_id, score desc"

exclude:
  - _db
